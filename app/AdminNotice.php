<?php
/**
 * Author: Damian Schwyrz <mail@damianschwyrz.de>
 * URL: https://www.damianschwyrz.de
 * Copyright (c) 2018.
 */

namespace App;

use Illuminate\Database\Eloquent\Model;

/**
 * Class AdminNotice
 * @package App
 */
class AdminNotice extends Model
{
    /**
     * @var array
     */
    protected $fillable = ['context', 'message', 'type', 'cmd'];

    /**
     * @param             $query
     * @param null|string $search
     *
     * @return mixed
     */
    public function scopeWithType($query, ?string $filter)
    {

        if ($filter != "" & $filter != "0") {
            return $query->where('type', $filter);
        }

        return $query;
    }

    /**
     * @param             $query
     * @param null|string $search
     *
     * @return mixed
     */
    public function scopeWithContext($query, ?string $context)
    {

        if ($context != "" && $context != "0") {
            return $query->where('context', $context);
        }

        return $query;
    }

    /**
     * @param             $query
     * @param null|string $search
     *
     * @return mixed
     */
    public function scopeWithSearch($query, ?string $search)
    {
        $search = trim($search);

        if ($search == '') {
            return $query;
        }

        return $query->where('type', 'like', $search . '%')
            ->orWhere('type', 'like', '%' . $search . '%')
            ->orWhere('context', 'like', $search . '%')
            ->orWhere('context', 'like', '%' . $search . '%')
            ->orWhere('message', 'like', $search . '%')
            ->orWhere('message', 'like', '%' . $search . '%')
            ->orWhere('cmd', 'like', $search . '%')
            ->orWhere('cmd', 'like', '%' . $search . '%');


    }
}
