<?php
/**
 * Author: Damian Schwyrz <mail@damianschwyrz.de>
 * URL: https://www.damianschwyrz.de
 * Copyright (c) 2018.
 */

namespace App\Task;

use Symfony\Component\Process\Process;

/**
 * Class Tsp
 * @package App\Task
 */
class Tsp
{
    /**
     * Checks if a process is running which uses tsp as queue handler. If a threshold is given, its possible to check
     * if a maximum number of tsp processes is running.
     *
     * @param int $threshold
     *
     * @return bool
     */
    public static function isRunning(int $threshold = 1): bool
    {
        $process = new Process('ps -A -ww | grep "tsp" | wc -l');
        $process->run();
        $output = $process->getOutput();
        $tspProcessesDetected = intval(trim($output));

        if ($tspProcessesDetected <= $threshold) {
            return false;
        }

        return true;
    }


}