/*
 * Author: Damian Schwyrz <mail@damianschwyrz.de>
 * URL: https://www.damianschwyrz.de
 * Copyright (c) 2018. 
 */


$(function () {


    $('#prepare-mass-masscan-project-modal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var route = button.data("url");

        $("#start-masscan-project-command").data("route", route);
        $("#start-masscan-project-command").attr("data-route", route);

    });

    $('#prepare-mass-masscan-project-modal').on('hide.bs.modal', function () {

        $("#start-masscan-project").find(".fa").addClass("hidden");

        $("#masscan-project-command span").html();
        $("#masscan-project-killcommand span").html();

        $("#masscan-project-command").fadeOut();
        $("#masscan-project-warn").fadeOut();
        $("#masscan-project-killcommand").fadeOut();

    });

    $(document).on('click', "#start-masscan-project-command", function (event) {
        event.preventDefault();

        var btn = $(this);
        var route = btn.data("route");
        var speed = $("#masscan-project-speed").val();
        var ports = $("#masscan-project-port").val();
        var type = $("#masscan-project-type").val();
        var limit = $("#masscan-project-limit").val();

        btn.find(".fa").removeClass("hidden");

        $.ajax({
            url: route,
            type: 'POST',
            data: {
                ports: ports,
                type: type,
                limit: limit,
                speed: speed
            },
            success: function (result) {
                console.log(result);
                $("#masscan-project-command span").html(result.command);
                $("#masscan-project-killcommand span").html(result.killcommand);

                $("#masscan-project-command").fadeIn();
                $("#masscan-project-warn").fadeIn();
                $("#masscan-project-killcommand").fadeIn();

                btn.find(".fa").addClass("hidden");
            },
            error: function (result) {
                console.log(result.responseJSON);
                masscanProjectError(result.responseJSON.message);
                btn.find(".fa").addClass("hidden");
            }
        });

    });

});

function masscanProjectError(message) {

    $("#masscan-project-error .alert span").html(message);
    $("#masscan-project-error").fadeIn();

    setTimeout(function () {
        $("#masscan-project-error").fadeOut("fast");
        $("#masscan-project-error .alert span").html("");

    }, 3200);
}