@extends('layouts.admin-dashboard')

@section('breadcrumbs')

    <section class="content-header">
        <h1>
            Projectlist
            <a class="pull-right btn btn-primary" href="{{ route('admin.project.create') }}"><i class="fa fa-plus"></i>
                Add new project</a>
        </h1>


    </section>

@endsection

@section('content')
    <div class="row">
        <div class="col-xs-12">

            <div class="box">
                <!-- /.box-header -->
                <div class="box-body table-responsive no-padding" style="overflow: visible;">

                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th></th>
                            <th>Domain</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th>Progress</th>
                            <th></th>
                            <th></th>
                        </tr>
                        </thead>

                        <tbody>
                        @foreach($projects as $project)
                            <tr class="project-{{ $project->id }}">
                                <td>
                                    <a href="{{ route('admin.project.edit',$project) }}">
                                        <span class="label label-default">Edit</span>
                                    </a>

                                    <a class="m-l-5" href="{{ route('admin.project.show',$project) }}">
                                        <span class="label label-primary">Show subdomains</span>
                                    </a>
                                </td>

                                <td>
                                    {{ $project->name }}
                                </td>

                                <td>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                            <span class="caret"></span> Actions
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li>
                                                <a href="#" data-domain="{{ $project->name }}" data-toggle="modal" data-target="#prepare-sublister-modal" data-href="{{ route('admin.sublister.scan',$project) }}">
                                                    Start sublist3r
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" data-domain="{{ $project->name }}" data-toggle="modal" data-target="#prepare-massdns-modal" data-href="{{ route('admin.massdns.scan',$project) }}">
                                                    Start massdns
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" data-domain="{{ $project->name }}" data-toggle="modal" data-target="#prepare-ctfr-modal" data-href="{{ route('admin.ctfr.scan',$project) }}">
                                                    Start CTFR (AXFR)
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" data-domain="{{ $project->name }}" data-toggle="modal" data-target="#prepare-facebook-ct-modal" data-href="{{ route('admin.facebook-ct.scan',$project) }}">
                                                    Start Facebook CT Scan
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" data-domain="{{ $project->name }}" data-toggle="modal" data-target="#prepare-bruteforce-modal" data-href="{{ route('admin.bruteforce.subdomains.simple',$project) }}">
                                                    Start bruteforcing
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{{route('admin.http-status.recheck-on-0',$project)}}" class="update-http-for-status-0">
                                                    Start Http-Check on domains w/o status
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" data-toggle="modal" data-target="#prepare-mass-nmap-modal" data-url="{{ route("admin.nmap.scan.without-report",$project) }}">
                                                    NMap: Scan targets without report
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" data-toggle="modal" data-target="#prepare-mass-dirsearch-modal" data-href="{{ route('admin.dirsearch.massscan',$project) }}">
                                                    Dirsearch: Scan targets without report
                                                </a>
                                            </li>

                                        </ul>
                                    </div>
                                </td>

                                <td>
                                    {{ $project->targets()->active()->count() }} domains
                                    @if($project->targets()->archived()->count()>0)
                                        <small>({{ $project->targets()->archived()->count() }} hidden)</small>
                                    @endif

                                </td>

                                <td>
                                    <a class="m-l-5" href="{{ route('admin.target.create',$project) }}">
                                        <span class="label label-primary">Add</span>
                                    </a>

                                    <a class="m-l-5" href="{{ route('admin.target.import',$project) }}">
                                        <span class="label label-primary">Mass import</span>
                                    </a>
                                </td>

                                <td>
                                    @include('admin.project.parts.progress-bar', ['all' => $project->targets()->active()->count(), 'checked' => $project->targets()->checked()->count()])
                                </td>

                                <td>
                                    @include('admin.project.parts.progress-badge', ['all' => $project->targets()->active()->count(), 'checked' => $project->targets()->checked()->count()])
                                </td>
                                <td>
                                    <a class="destroy-project pull-right" data-id="{{ $project->id }}" href="{{ route('admin.project.destroy',$project) }}">
                                        <span class="label label-danger">Delete</span>
                                    </a>

                                    <a class="archive-project pull-right" data-id="{{ $project->id }}" href="{{ route('admin.project.archive',$project) }}">
                                        <span class="label label-warning">Archive</span>
                                    </a>
                                </td>

                            </tr>
                        @endforeach
                        </tbody>
                    </table>
                </div>

                <div class="box-footer">
                        {{ $projects->appends(Input::except('page'))->links() }}
                </div>
            </div>

            <!-- /.box -->
        </div>

        <div class="col-md-6">
            <a class="btn btn-primary" href="{{ route('admin.project.archived-projects') }}"><i class="fa fa-archive"></i>
                Archived projects
            </a>
        </div>

        <div class="col-md-6">
            <a class="pull-right btn btn-primary" href="{{ route('admin.project.create') }}"><i class="fa fa-plus"></i>
                Add new project
            </a>
        </div>

    </div>
@endsection

@push('script-files')
    <script src="{{ mix('js/admin/bundle.min.js') }}"></script>
@endpush

@push('modals')
    @include('admin.project.modals.sublister')
    @include('admin.project.modals.massdns')
    @include('admin.project.modals.facebook-ct')
    @include('admin.project.modals.ctfr')
    @include('admin.project.modals.bruteforce')
    @include('admin.project.modals.dirsearch-mass')
    @include('admin.project.modals.nmap-mass')

    <div id="infobox">
        <div class="alert alert-info">
            <span></span>
        </div>
    </div>
@endpush